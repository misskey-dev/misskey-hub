import{_ as e,o as s,c as n,e as a}from"./app.885c6794.js";const i={},l=a(`<h1 id="misskey-\u5B89\u88C5\u4E0E\u914D\u7F6E\u6559\u7A0B" tabindex="-1"><a class="header-anchor" href="#misskey-\u5B89\u88C5\u4E0E\u914D\u7F6E\u6559\u7A0B" aria-hidden="true">#</a> Misskey \u5B89\u88C5\u4E0E\u914D\u7F6E\u6559\u7A0B</h1><p>\u611F\u8C22\u60A8\u5BF9\u642D\u5EFA Misskey \u670D\u52A1\u5668\u611F\u5174\u8DA3\uFF01 \u672C\u7BC7\u6559\u7A0B\u53D9\u8FF0\u4E86\u5982\u4F55\u5B89\u88C5\u548C\u914D\u7F6E Misskey\u3002</p><hr><div class="custom-container danger"><i class="fas fa-times"></i><p>\u8BF7\u6CE8\u610F\uFF0C\u4E00\u65E6 Misskey \u5F00\u59CB\u8FD0\u884C\uFF0C\u4E0D\u8981\u66F4\u6539\u57DF\u540D\u548C\u670D\u52A1\u5668\u7684\u4E3B\u673A\u540D\u3002</p></div><h2 id="_1-\u5B89\u88C5\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1-\u5B89\u88C5\u4F9D\u8D56" aria-hidden="true">#</a> <em>1.</em> \u5B89\u88C5\u4F9D\u8D56</h2><p>\u8BF7\u5B89\u88C5\u4EE5\u4E0B\u8F6F\u4EF6\uFF1A</p><h4 id="dependencies" tabindex="-1"><a class="header-anchor" href="#dependencies" aria-hidden="true">#</a> Dependencies \u{1F4E6}</h4><ul><li><strong><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js</a></strong> (20.4.x)</li><li><strong><a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL</a></strong> (15.x)</li><li><strong><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis</a></strong></li><li><strong><a href="https://www.ffmpeg.org/" target="_blank" rel="noopener noreferrer">FFmpeg</a></strong></li></ul><p>\u5728 Debian \u548C Ubuntu \u7CFB\u7EDF\u4E2D\uFF0C\u60A8\u8FD8\u9700\u8981\u5B89\u88C5 <code>build-essential</code> \u4E0E <code>python</code> \u3002</p><p>\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u542F\u7528 corepack\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> corepack <span class="token builtin class-name">enable</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_2-\u521B\u5EFA\u4E00\u4E2A\u8FD0\u884C-misskey-\u7684\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA\u4E00\u4E2A\u8FD0\u884C-misskey-\u7684\u7528\u6237" aria-hidden="true">#</a> <em>2.</em> \u521B\u5EFA\u4E00\u4E2A\u8FD0\u884C Misskey \u7684\u7528\u6237</h2><p>\u5728 root \u4E0B\u8FD0\u884C Misskey \u4E0D\u662F\u4E00\u4E2A\u597D\u4E3B\u610F\uFF0C\u6240\u4EE5\u6211\u4EEC\u521B\u5EFA\u4E00\u4E2A\u65B0\u7528\u6237 misskey\u3002 \u4F8B\u5982\uFF0C\u5728 Debian \u4E2D\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>adduser --disabled-password --disabled-login misskey
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-\u5B89\u88C5-misskey" tabindex="-1"><a class="header-anchor" href="#_3-\u5B89\u88C5-misskey" aria-hidden="true">#</a> <em>3.</em> \u5B89\u88C5 Misskey</h2><ol><li><p>\u5207\u6362\u81F3 <code>misskey</code> \u7528\u6237\uFF1A</p><p><code>sudo -iu misskey</code></p></li><li><p>\u5C06 Misskey \u514B\u9686\u81F3\u672C\u5730\uFF1A</p><p><code>git clone --recursive https://github.com/misskey-dev/misskey.git</code></p></li><li><p>\u8FDB\u5165 misskey \u4ED3\u5E93\uFF1A</p><p><code>cd misskey</code></p></li><li><p>\u68C0\u67E5\u662F\u5426\u4E3A <a href="https://github.com/misskey-dev/misskey/releases/latest" target="_blank" rel="noopener noreferrer">\u6700\u65B0\u7248\u672C</a> \uFF08\u5206\u652F\u662F\u5426\u4E3A master\uFF09\uFF1A</p><p><code>git checkout master</code></p></li><li><p>\u4E0B\u8F7D\u5B50\u6A21\u5757\uFF1A</p><p><code>git submodule update --init</code></p></li><li><p>\u5B89\u88C5 Misskey \u7684\u4F9D\u8D56\u9879\uFF1A</p><p><code>pnpm install --frozen-lockfile</code></p></li></ol><h2 id="_4-\u914D\u7F6E-misskey" tabindex="-1"><a class="header-anchor" href="#_4-\u914D\u7F6E-misskey" aria-hidden="true">#</a> <em>4.</em> \u914D\u7F6E Misskey</h2><ol><li>\u590D\u5236 <code>.config/example.yml</code> \u5E76\u91CD\u547D\u540D\u4E3A <code>default.yml</code>.</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> .config/example.yml .config/default.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>\u7F16\u8F91 <code>default.yml</code></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">nano</span> default.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_5-\u7F16\u8BD1-misskey" tabindex="-1"><a class="header-anchor" href="#_5-\u7F16\u8BD1-misskey" aria-hidden="true">#</a> <em>5.</em> \u7F16\u8BD1 Misskey</h2><p>\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u7F16\u8BD1 Misskey\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production <span class="token function">pnpm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u679C\u60A8\u4F7F\u7528 Debian\uFF0C\u5219\u9700\u8981\u5B89\u88C5 build-essential \u548C python \u8F6F\u4EF6\u5305\u3002</p><h2 id="_6-\u521B\u5EFA\u5E76\u521D\u59CB\u5316\u6570\u636E\u5E93" tabindex="-1"><a class="header-anchor" href="#_6-\u521B\u5EFA\u5E76\u521D\u59CB\u5316\u6570\u636E\u5E93" aria-hidden="true">#</a> <em>6.</em> \u521B\u5EFA\u5E76\u521D\u59CB\u5316\u6570\u636E\u5E93</h2><ol><li><p>\u4E0B\u9762\u6211\u4EEC\u6765\u65B0\u5EFA\u6570\u636E\u5E93\u3002\u8F93\u5165\u4EE5\u4E0B\u547D\u4EE4\u5207\u6362\u81F3 postgres \u7528\u6237\u5E76\u8FDB\u5165\u6570\u636E\u5E93\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo -u postgres psql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8F93\u5165\u4EE5\u4E0B\u547D\u4EE4\u6765\u65B0\u5EFA\u6570\u636E\u5E93\u53CA\u7528\u6237\uFF08\u8BF7\u6CE8\u610F\uFF0C\u6570\u636E\u5E93\u9700\u8981\u4EE5 UTF8 \u7F16\u7801\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>create database misskey with encoding = &#39;UTF8&#39;;
create user misskey with encrypted password &#39;{YOUR_PASSWORD}&#39;;
grant all privileges on database misskey to misskey;
\\q
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u6765\u521D\u59CB\u5316\u6570\u636E\u5E93\uFF1A <code>pnpm run init</code></p></li></ol><h2 id="_7-\u73AF\u5883\u914D\u7F6E\u5B8C\u6210" tabindex="-1"><a class="header-anchor" href="#_7-\u73AF\u5883\u914D\u7F6E\u5B8C\u6210" aria-hidden="true">#</a> <em>7.</em> \u73AF\u5883\u914D\u7F6E\u5B8C\u6210\uFF01</h2><p>\u5E72\u5F97\u6F02\u4EAE\uFF01\u73B0\u5728\uFF0C\u60A8\u6709\u4E00\u4E2A\u53EF\u4EE5\u8FD0\u884C Misskey \u7684\u73AF\u5883\u4E86\u3002</p><h3 id="\u6B63\u5E38\u542F\u52A8-\u524D\u53F0-\u4E0D\u53EF\u9000\u51FA\u7EC8\u7AEF\u6216-ssh" tabindex="-1"><a class="header-anchor" href="#\u6B63\u5E38\u542F\u52A8-\u524D\u53F0-\u4E0D\u53EF\u9000\u51FA\u7EC8\u7AEF\u6216-ssh" aria-hidden="true">#</a> \u6B63\u5E38\u542F\u52A8\uFF08\u524D\u53F0\uFF0C\u4E0D\u53EF\u9000\u51FA\u7EC8\u7AEF\u6216 ssh\uFF09</h3><p>\u8FD0\u884C <code>NODE_ENV=production pnpm run start</code>\u3002</p><h3 id="\u4EE5-systemd-\u65B9\u5F0F\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u4EE5-systemd-\u65B9\u5F0F\u542F\u52A8" aria-hidden="true">#</a> \u4EE5 systemd \u65B9\u5F0F\u542F\u52A8</h3><ol><li><p>\u521B\u5EFA systemd \u670D\u52A1\uFF1A</p><p><code>nano /etc/systemd/system/misskey.service</code></p></li><li><p>\u5C06\u4EE5\u4E0B\u5185\u5BB9\u590D\u5236\u8FDB\u53BB\uFF1A</p><details class="custom-container details"><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[Unit]
Description=Misskey daemon

[Service]
Type=simple
User=misskey
ExecStart=/usr/bin/npm start
WorkingDirectory=/home/misskey/misskey
Environment=&quot;NODE_ENV=production&quot;
TimeoutSec=60
StandardOutput=journal
StandardError=journal
SyslogIdentifier=misskey
Restart=always

[Install]
WantedBy=multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></li><li><p>\u91CD\u8F7D systemd \u5E76\u4F7F misskey service \u5F00\u673A\u81EA\u542F\uFF1A</p><p><code>sudo systemctl daemon-reload; sudo systemctl enable misskey</code></p></li><li><p>\u542F\u52A8 misskey service\uFF1A</p><p><code>sudo systemctl start misskey</code></p></li></ol><p>\u60A8\u53EF\u4EE5\u6267\u884C <code>systemctl status misskey</code>\u68C0\u67E5\u8BE5\u670D\u52A1\u9879\u662F\u5426\u6B63\u5728\u8FD0\u884C\u3002</p><h3 id="\u4F7F\u7528-openrc-\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-openrc-\u542F\u52A8" aria-hidden="true">#</a> \u4F7F\u7528 OpenRC \u542F\u52A8</h3><ol><li><p>\u5C06\u4EE5\u4E0B\u6587\u672C\u590D\u5236\u5230 <code>/etc/init.d/misskey</code>:</p><details class="custom-container details"><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/sbin/openrc-run</span>

<span class="token assign-left variable">name</span><span class="token operator">=</span>misskey
<span class="token assign-left variable">description</span><span class="token operator">=</span><span class="token string">&quot;Misskey daemon&quot;</span>

<span class="token assign-left variable">command</span><span class="token operator">=</span><span class="token string">&quot;/usr/bin/npm&quot;</span>
<span class="token assign-left variable">command_args</span><span class="token operator">=</span><span class="token string">&quot;start&quot;</span>
<span class="token assign-left variable">command_user</span><span class="token operator">=</span><span class="token string">&quot;misskey&quot;</span>

<span class="token assign-left variable">supervisor</span><span class="token operator">=</span><span class="token string">&quot;supervise-daemon&quot;</span>
<span class="token assign-left variable">supervise_daemon_args</span><span class="token operator">=</span><span class="token string">&quot; -d /home/misskey/misskey -e NODE_ENV=<span class="token entity" title="\\&quot;">\\&quot;</span>production<span class="token entity" title="\\&quot;">\\&quot;</span>&quot;</span>

<span class="token assign-left variable">pidfile</span><span class="token operator">=</span><span class="token string">&quot;/run/<span class="token variable">\${RC_SVCNAME}</span>.pid&quot;</span>

<span class="token function-name function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	need net
	use logger

	<span class="token comment"># alternatively, uncomment if using nginx reverse proxy</span>
	<span class="token comment">#use logger nginx</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></li><li><p>\u8BBE\u7F6E\u5F00\u673A\u81EA\u542F\uFF1A</p><p><code>rc-update add misskey</code></p></li><li><p>\u542F\u52A8 Misskey service\uFF1A</p><p><code>rc-service misskey start</code></p></li></ol><p>\u60A8\u53EF\u4EE5\u6267\u884C <code>rc-service misskey status</code>\u6765\u68C0\u67E5\u8BE5\u670D\u52A1\u9879\u662F\u5426\u6B63\u5728\u8FD0\u884C\u3002</p><h3 id="\u5982\u4F55\u66F4\u65B0-misskey" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u66F4\u65B0-misskey" aria-hidden="true">#</a> \u5982\u4F55\u66F4\u65B0 Misskey\uFF1F</h3><p>\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF1A</p><ol><li><code>git checkout master</code></li><li><code>git pull</code></li><li><code>git submodule update --init</code></li><li><code>NODE_ENV=production pnpm install --frozen-lockfile</code></li><li><code>NODE_ENV=production pnpm run build</code></li><li><code>pnpm run migrate</code></li><li>\u91CD\u65B0\u542F\u52A8 Misskey \u8FDB\u7A0B\u4EE5\u5E94\u7528\u66F4\u6539</li><li>\u5F00\u59CB\u4F7F\u7528\u5427\uFF5E</li></ol><p>\u5982\u679C\u66F4\u65B0\u9047\u5230\u4EFB\u4F55\u95EE\u9898\uFF0C\u8BF7\u5C1D\u8BD5\u4EE5\u4E0B\u64CD\u4F5C\uFF1A</p><ol><li><code>pnpm run clean</code> \u6216 <code>pnpm run clean-all</code></li><li>\u91CD\u65B0\u66F4\u65B0 (\u522B\u5FD8\u4E86\u6267\u884C <code>pnpm install</code>)</li></ol>`,42),d=[l];function r(t,o){return s(),n("div",null,d)}var p=e(i,[["render",r],["__file","manual.html.vue"]]);export{p as default};
